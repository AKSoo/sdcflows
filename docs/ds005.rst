ds005
=====

``fmriprep``'s ds005 pipeline is used on datasets for which there are only t1ws and at least one functional (EPI) file.
Use the `--workflow-type ds005` or allow ``fmriprep`` to automatically determine the approriate workflow.

What It Does
------------
High-level view of the ds005 pipeline:

.. graphviz:: ds005.dot

BIDSDatasource
~~~~~~~~~~~~~~

This node reads the `BIDS`_-formatted input data and kicks off the rest of the workflow.

t1w_preprocessing
~~~~~~~~~~~~~~~~~

.. graphviz:: t1w_preprocessing.dot

The t1w_preprocessing sub-workflow finds transforms between the t1w and MNI space, finds the skull stripping mask, and finds the white matter/gray matter/cerebrospinal fluid segments.

EPI_HMC
~~~~~~

.. graphviz:: EPI_HMC.dot

The EPI_HMC sub-workflow performs head motion correction over the input EPI (echo-planar imaging) image.

NOTE: why doesn't the graphviz img show any inputs to EPI_HMC?

EPIMeanNormalization
~~~~~~~~~~~~~~~~~~~~

.. graphviz:: EPIMeanNormalization.dot

The EPIMeanNormalization sub-workflow uses FSL FLIRT with the BBR cost function to find the transform that maps the EPI space into the T1-space

EPIMNITransformation
~~~~~~~~~~~~~~~~~~~~

.. graphviz:: EPIMNITransformation.dot

The EPIMNITransformation sub-workflow uses the transform from `EPIMeanNormalization`_ and a t1-to-MNI transform from `t1w_preprocessing`_ to map the EPI image to standardized MNI space.
It also maps the t1w-based mask to MNI space.

ConfoundDiscoverer
~~~~~~~~~~~~~~~~~~

.. graphviz:: ConfoundDiscoverer.dot

Given a motion-corrected fMRI, a brain mask, MCFLIRT movement parameters and a segmentation, the ConfoundDiscoverer sub-workflow calculates potential confounds per volume.
Calculated confounds include the global regressor, segment regressors, tCompCor, aCompCor, and DVARS.


Reports
-------

Some stuff about reports.

Derivatives
-----------

There are additional files, called "Derivatives", outputted to ``<output dir>/derivatives``.
See the `BIDS`_ spec for more information.

Derivatives related to t1w files are in the ``anat`` subfolder:

- ``*T1w_brainmask.nii.gz``
- ``*T1w_dtissue.nii.gz``
- ``*T1w_preproc.nii.gz``
- ``*T1w_target-meanBOLD_affine.txt``
<incomplete>

Derivatives related to BOLD files are in the ``func`` subfolder:

- ``*bold_brainmask.nii.gz
- ``*bold_preproc.nii.gz
- ``*bold_target-T1w_affine.txt
<incomplete>

Images
------

The ``images`` subfolder of the output directory contains images (e.g., ``.svg``, ``.png``) produced by `fmriprep`.
Each image is accompanied by a ``.json`` file that contains metadata about how the image was produced.
